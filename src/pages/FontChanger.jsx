import { useEffect, useState } from "react";
import WebFont from "webfontloader";

const API_KEY = "AIzaSyAPJEzmV6k5wBYj9PXyZH6zYm-W2v9rV00"; // <-- replace with your key
const API_URL = `https://www.googleapis.com/webfonts/v1/webfonts?key=${API_KEY}`;

export default function FontChanger() {
  const [fonts, setFonts] = useState([]);
  const [fontIndex, setFontIndex] = useState(0);

  // Fetch font list from Google Fonts API
  useEffect(() => {
    async function fetchFonts() {
      try {
        const res = await fetch(API_URL);
        const data = await res.json();
        const fontNames = data.items.map((item) => item.family);
        setFonts(fontNames);
        loadFont(fontNames[0]);
      } catch (err) {
        console.error("Error fetching fonts:", err);
      }
    }
    fetchFonts();
  }, []);

  // Load selected font
  const loadFont = (fontName) => {
    WebFont.load({
      google: {
        families: [fontName],
      },
    });
  };

  // Change font
  const changeFont = () => {
    setFontIndex((prev) => {
      const nextIndex = (prev + 1) % fonts.length;
      if (fonts[nextIndex]) {
        loadFont(fonts[nextIndex]);
      }
      return nextIndex;
    });
  };

  // Space bar press
  useEffect(() => {
    const handleKeyDown = (e) => {
      if (e.code === "Space") {
        e.preventDefault();
        changeFont();
      }
    };
    window.addEventListener("keydown", handleKeyDown);
    return () => window.removeEventListener("keydown", handleKeyDown);
  }, [fonts]);

  return (
    <div
      style={{
        padding: "2rem",
        display: "flex",
        flexDirection: "column",
        height: "100vh",
        gap: "16px",
        textAlign: "center",
        alignItems: "center",
        justifyContent: "center",
      }}
    >
      <svg
        width="236"
        height="71"
        viewBox="0 0 236 71"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M27.3659 47.1997H12.9974L10.6941 54H0.877464L14.8072 15.5013H25.6658L39.5956 54H29.6693L27.3659 47.1997ZM24.9529 39.9606L20.1817 25.8663L15.4653 39.9606H24.9529ZM62.4812 23.0694C66.0642 23.0694 68.9159 24.2393 71.0365 26.5792C73.1936 28.8826 74.2721 32.0634 74.2721 36.1217V54H64.9491V37.383C64.9491 35.3356 64.4189 33.7452 63.3586 32.6118C62.2984 31.4784 60.8725 30.9117 59.081 30.9117C57.2895 30.9117 55.8636 31.4784 54.8034 32.6118C53.7431 33.7452 53.213 35.3356 53.213 37.383V54H43.8351V23.3984H53.213V27.4567C54.1636 26.104 55.4432 25.0437 57.0519 24.2759C58.6606 23.4716 60.4703 23.0694 62.4812 23.0694ZM85.5052 20.2176C83.8599 20.2176 82.5072 19.7423 81.4469 18.7918C80.4232 17.8046 79.9114 16.5981 79.9114 15.1722C79.9114 13.7098 80.4232 12.5033 81.4469 11.5527C82.5072 10.5655 83.8599 10.0719 85.5052 10.0719C87.1139 10.0719 88.4301 10.5655 89.4538 11.5527C90.5141 12.5033 91.0442 13.7098 91.0442 15.1722C91.0442 16.5981 90.5141 17.8046 89.4538 18.7918C88.4301 19.7423 87.1139 20.2176 85.5052 20.2176ZM90.1667 23.3984V54H80.7888V23.3984H90.1667ZM122.519 27.6761C121.824 26.3964 120.819 25.4276 119.503 24.7695C118.223 24.0748 116.706 23.7275 114.951 23.7275C111.916 23.7275 109.485 24.7329 107.657 26.7438C105.829 28.7181 104.915 31.3687 104.915 34.6958C104.915 38.2422 105.865 41.0208 107.767 43.0317C109.704 45.006 112.355 45.9931 115.719 45.9931C118.022 45.9931 119.96 45.4082 121.532 44.2382C123.14 43.0683 124.31 41.3865 125.042 39.1928H113.141V32.2828H133.542V41.0026C132.847 43.3425 131.659 45.5178 129.977 47.5287C128.332 49.5396 126.23 51.1665 123.671 52.4096C121.111 53.6527 118.223 54.2742 115.006 54.2742C111.203 54.2742 107.803 53.4516 104.805 51.8063C101.844 50.1245 99.5221 47.8029 97.8402 44.8415C96.195 41.88 95.3724 38.4981 95.3724 34.6958C95.3724 30.8934 96.195 27.5116 97.8402 24.5501C99.5221 21.5521 101.844 19.2305 104.805 17.5852C107.767 15.9034 111.148 15.0625 114.951 15.0625C119.557 15.0625 123.433 16.1776 126.577 18.4079C129.758 20.6381 131.86 23.7275 132.884 27.6761H122.519ZM136.872 38.6444C136.872 35.5001 137.457 32.7398 138.627 30.3633C139.833 27.9868 141.46 26.1588 143.508 24.8792C145.555 23.5995 147.84 22.9597 150.363 22.9597C152.52 22.9597 154.403 23.3984 156.012 24.2759C157.657 25.1534 158.918 26.305 159.796 27.7309V23.3984H169.174V54H159.796V49.6675C158.882 51.0934 157.602 52.2451 155.957 53.1225C154.348 54 152.465 54.4387 150.308 54.4387C147.822 54.4387 145.555 53.7989 143.508 52.5193C141.46 51.2031 139.833 49.3568 138.627 46.9803C137.457 44.5673 136.872 41.7886 136.872 38.6444ZM159.796 38.6992C159.796 36.3593 159.138 34.513 157.821 33.1602C156.542 31.8075 154.97 31.1311 153.105 31.1311C151.24 31.1311 149.65 31.8075 148.334 33.1602C147.054 34.4764 146.414 36.3045 146.414 38.6444C146.414 40.9843 147.054 42.8489 148.334 44.2382C149.65 45.591 151.24 46.2673 153.105 46.2673C154.97 46.2673 156.542 45.591 157.821 44.2382C159.138 42.8855 159.796 41.0391 159.796 38.6992ZM184.733 46.2673H198.004V54H174.258V46.5416L186.981 31.1311H174.368V23.3984H197.73V30.8569L184.733 46.2673ZM232.011 38.2056C232.011 39.0831 231.956 39.9971 231.847 40.9477H210.623C210.769 42.8489 211.373 44.3113 212.433 45.335C213.53 46.3222 214.864 46.8158 216.436 46.8158C218.776 46.8158 220.403 45.8286 221.317 43.8543H231.298C230.786 45.8652 229.854 47.6749 228.501 49.2836C227.185 50.8923 225.522 52.1537 223.511 53.0677C221.5 53.9817 219.251 54.4387 216.765 54.4387C213.767 54.4387 211.098 53.7989 208.758 52.5193C206.419 51.2396 204.591 49.4116 203.274 47.0351C201.958 44.6587 201.3 41.88 201.3 38.6992C201.3 35.5184 201.94 32.7398 203.219 30.3633C204.536 27.9868 206.364 26.1588 208.704 24.8792C211.044 23.5995 213.731 22.9597 216.765 22.9597C219.727 22.9597 222.359 23.5812 224.663 24.8243C226.966 26.0674 228.757 27.8406 230.037 30.1439C231.353 32.4473 232.011 35.1345 232.011 38.2056ZM222.414 35.7378C222.414 34.1291 221.866 32.8495 220.769 31.8989C219.672 30.9483 218.301 30.473 216.656 30.473C215.084 30.473 213.749 30.93 212.652 31.844C211.592 32.7581 210.934 34.056 210.678 35.7378H222.414Z"
          fill="#E8D7F1"
        />
        <ellipse
          cx="85.894"
          cy="13.4548"
          rx="13.5187"
          ry="13.4548"
          fill="#FF0000"
        />
        <ellipse
          cx="84.5421"
          cy="13.4548"
          rx="5.40748"
          ry="5.38193"
          fill="black"
        />
        <ellipse
          cx="80.4865"
          cy="12.1093"
          rx="4.05561"
          ry="4.03645"
          fill="white"
          fill-opacity="0.5"
        />
      </svg>
      <p
        style={{
          fontFamily: fonts[fontIndex],
          fontSize: "2rem",
          transition: "all 0.3s ease",
          maxWidth: "800px",
          maxHeight: "400px"
        }}
      >
        Lorem ipsum dolor sit amet consectetur, adipisicing elit. Dolores,
        libero. Incidunt nihil cum consequatur atque amet odit, nobis laudantium
        sed doloremque reprehenderit illo dolore quo perspiciatis voluptatum
        harum id possimus.
      </p>

      <h1
        onClick={changeFont}
        title="Click to change font"
        style={{
          cursor: "pointer",
          width: "600px",
          marginTop: "30px",
          border: "10px solid var(--prime)",
          padding: "20px",
        }}
      >
        Font Changes to ({fonts[fontIndex] || "Loading..."})
      </h1>
      <p>Click or press Space to change font</p>
    </div>
  );
}
